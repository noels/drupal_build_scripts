ext.runCmd = {String cmd, File baseDir ->
    def sout = new StringBuffer()
    def serr = new StringBuffer()
    def outProc = Runtime.runtime.exec(cmd, [] as String[], baseDir)
    def running = true
    def bufferPrinter = {buffer ->
      def lastIndex = 0
      while(running) {
        def length = buffer.length()
        if (length > lastIndex) {
          print buffer.subSequence(lastIndex, length)
          lastIndex = length
        }
        Thread.sleep(100)
      }
    }
    Thread.start bufferPrinter.curry(sout)
    Thread.start bufferPrinter.curry(serr)

    outProc.consumeProcessOutput(sout, serr)
    try {
      outProc.waitFor()
    }
    finally {
      running = false
    }

    if (outProc.exitValue()) {
      println "Error code: ${outProc.exitValue()}"
      System.exit(1)
    }
}
